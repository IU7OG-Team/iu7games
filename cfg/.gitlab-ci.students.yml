stages:
  - build

variables:
  COMPILE_FLAGS: -Werror -Wall -Wextra -Wpedantic -Wcast-align -Wcast-qual
    -Wconversion  -Wenum-compare -Wfloat-equal  -Wredundant-decls -Wsign-conversion -c
  XOGAME_PATH: XOgame/
  STRGAME_PATH: STRgame/
  TEEN48GAME_PATH: TEEN48game/

strgame:
  stage: build
  image: hackfeed/iu7games
  script:
    - if [ -e ${STRGAME_PATH}${GITLAB_USER_LOGIN}_split.c ];
      then
      VAR=$(sed -n 's/\(system(".*");\)/\1/p' ${STRGAME_PATH}${GITLAB_USER_LOGIN}_split.c)y;
      if [ "$VAR" != 'y' ];
      then
      exit 1;
      else
      gcc ${COMPILE_FLAGS} -fpic ${STRGAME_PATH}${GITLAB_USER_LOGIN}_split.c;
      fi;
      fi
    - if [ -e ${STRGAME_PATH}${GITLAB_USER_LOGIN}_strtok.c ];
      then
      VAR=$(sed -n 's/\(system(".*");\)/\1/p' ${STRGAME_PATH}${GITLAB_USER_LOGIN}_strtok.c)y;
      if [ "$VAR" != 'y' ];
      then
      exit 1;
      else
      gcc ${COMPILE_FLAGS} -fpic ${STRGAME_PATH}${GITLAB_USER_LOGIN}_strtok.c;
      fi;
      fi
    - if [ -e ${GITLAB_USER_LOGIN}_split.o ];
      then gcc -shared -o ${GITLAB_USER_LOGIN}_split_lib.so ${GITLAB_USER_LOGIN}_split.o;
      fi
    - if [ -e ${GITLAB_USER_LOGIN}_strtok.o ];
      then gcc -shared -o ${GITLAB_USER_LOGIN}_strtok_lib.so ${GITLAB_USER_LOGIN}_strtok.o;
      fi
  after_script:
    - rm -f *.o
  artifacts:
    paths:
      - ./*.so
  only:
    refs:
      - STRgame
